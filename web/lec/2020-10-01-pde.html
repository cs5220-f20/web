---
title: Distributed parameter models
layout: slides
audio: 2020-10-01-pde
---

<section>
  <h1><a href="https://www.cs.cornell.edu/courses/cs5220/2020fa/">CS 5220</a></h1>
  <h2>Applications of Parallel Computers</h2>
  <h3>Distributed parameter models</h3>
  <p>
    <small>Prof <a href="http://www.cs.cornell.edu/~bindel">David Bindel</a></small>
  </p>
  <p>Please click the play button below.</p>

  <aside class="notes">
  </aside>
</section>


<section>
  <h3>Types of PDEs</h3>
  <table>
    <thead>
      <tr class="header">
        <th style="text-align: left;">Type</th>
        <th style="text-align: left;">Example</th>
        <th style="text-align: left;">Time?</th>
        <th style="text-align: left;">Space dependence?</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td style="text-align: left;">Elliptic</td>
        <td style="text-align: left;">electrostatics</td>
        <td style="text-align: left;">steady</td>
        <td style="text-align: left;">global</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;">Hyperbolic</td>
        <td style="text-align: left;">sound waves</td>
        <td style="text-align: left;">yes</td>
        <td style="text-align: left;">local</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;">Parabolic</td>
        <td style="text-align: left;">diffusion</td>
        <td style="text-align: left;">yes</td>
        <td style="text-align: left;">global</td>
      </tr>
    </tbody>
  </table>
</section>


<section>
  <h3>Types of PDEs</h3>
  
  <p>Different types involve different communication:</p>
  <ul>
    <li>Global dependence <span class="math inline">\(\implies\)</span> lots of communication<br />
      (or tiny steps)</li>
    <li>Local dependence from finite wave speeds;<br />
      limits communication</li>
  </ul>
</section>


<section>
  <h3>Example: 1D heat equation</h3>
  <p>Consider flow (e.g. of heat) in a uniform rod</p>
  <ul>
    <li>Heat (<span class="math inline">\(Q\)</span>) <span class="math inline">\(\propto\)</span> temperature (<span class="math inline">\(u\)</span>) <span class="math inline">\(\times\)</span> mass (<span class="math inline">\(\rho h\)</span>)</li>
    <li>Heat flow <span class="math inline">\(\propto\)</span> temperature gradient (Fourier’s law)</li>
  </ul>
  <p><span class="math display">\[\begin{aligned}
      \frac{\partial Q}{\partial t} \propto
      h \frac{\partial u}{\partial t} &amp;\approx
      C \left[ \left( \frac{u(x-h)-u(x)}{h} \right) +
      \left( \frac{u(x)-u(x+h)}{h} \right) \right] \\
      \frac{\partial u}{\partial t} &amp;\approx
      C \left[ \frac{u(x-h)-2u(x)+u(x+h)}{h^2} \right] \rightarrow
      C \frac{\partial^2 u}{\partial x^2}
      \end{aligned}\]</span></p>
</section>


<section>
  <h3>Spatial discretization</h3>
  <p>Heat equation with <span class="math inline">\(u(0) = u(1) =
      0\)</span> <span class="math display">\[\frac{\partial u}{\partial
      t} = C \frac{\partial^2 u}{\partial x^2}\]</span></p>
</section>


<section>
  <h3>Spatial discretization</h3>
  <p>Spatial semi-discretization: <span class="math
                                               display">\[\frac{\partial^2
      u}{\partial x^2} \approx
      \frac{u(x-h)-2u(x)+u(x+h)}{h^2}\]</span>
  </p>
</section>


<section>
  <h3>Spatial discretization</h3>
  <p>
    Yields a system of ODEs <span class="math display">\[\frac{du}{dt} = C h^{-2} (-T) u =
      -C h^{-2}
      \begin{bmatrix}
      2 &amp; -1      &amp;   &amp;    &amp;        &amp; \\
      -1 &amp;  2      &amp; -1 &amp;    &amp;        &amp; \\
      &amp; \ddots  &amp; \ddots &amp; \ddots &amp; \\
      &amp;         &amp; -1      &amp; 2     &amp; -1 \\
      &amp;         &amp;        &amp;  -1     &amp; 2
      \end{bmatrix}
      \begin{bmatrix} u_1 \\ u_2 \\ \vdots \\ u_{n-2} \\ u_{n-1} \end{bmatrix}\]</span></p>
</section>


<section>
  <h3>Explicit time stepping</h3>
  <p>Approximate PDE by ODE system (“method of lines”): <span class="math display">\[\frac{du}{dt} = C h^{-2} T u\]</span> Now need a time-stepping scheme for the ODE.</p>
</section>


<section>
  <h3>Explicit time stepping</h3>
  <ul>
    <li>Simplest scheme is Euler: <span class="math display">\[u(t+\delta) \approx u(t) + u&#39;(t) \delta
        = \left( I - C \frac{\delta}{h^2} T \right) u(t)\]</span></li>
    <li>Taking a time step <span class="math inline">\(\equiv\)</span> sparse matvec with <span class="math inline">\(\left( I - C \frac{\delta}{h^2} T \right)\)</span></li>
    <li>This may not end well...</li>
  </ul>
</section>


<section>
  <h3>Explicit time stepping data dependence</h3>
  <p>Nearest neighbor interactions per step <span class="math inline">\(\implies\)</span><br />
    finite rate of numerical information propagation</p>
</section>


<section>
  <h3>Explicit time stepping in parallel</h3>
  <pre>for t = 1 to N
    communicate boundary data (&quot;ghost cell&quot;)
    take time steps locally
    end</pre>
</section>


<section>
  <h3>Overlapping communication with computation</h3>
  <pre>for t = 1 to N
    start boundary data sendrecv
    compute new interior values
    finish sendrecv
    compute new boundary values
    end</pre>
</section>


<section>
  <h3>Batching time steps</h3>
  <pre>for t = 1 to N by B
    start boundary data sendrecv (B values)
    compute new interior values
    finish sendrecv (B values)
    compute new boundary values
    end</pre>
</section>


<section>
  <h3>Explicit pain</h3>
  <p><embed data-src="figs/explicit-unstable-demo.pdf" style="width:80.0%" /><br />
    Unstable for <span class="math inline">\(\delta &gt; O(h^2)\)</span>!</p>
</section>


<section>
  <h3>Implicit time stepping</h3>
  <ul>
    <li>Backward Euler uses backward difference for <span class="math inline">\(d/dt\)</span> <span class="math display">\[u(t+\delta) \approx u(t) + u&#39;(t + \delta t) \delta\]</span></li>
    <li>Time step <span class="math inline">\(\equiv\)</span> apply <span class="math inline">\(\left( I + C \frac{\delta}{h^2} T \right)^{-1}\)</span></li>
    <li>No time step restriction for stability (good!)</li>
    <li>But each step involves linear solve (not so good!)
      <ul>
        <li>Good if you like numerical linear algebra?</li>
    </ul></li>
  </ul>
</section>


<section>
  <h3>Explicit and implicit</h3>
  <p>Explicit:</p>
  <ul>
    <li>Propagates information at finite rate</li>
    <li>Steps look like sparse matvec (in linear case)</li>
    <li>Stable step determined by fastest time scale</li>
    <li>Works fine for <em>hyperbolic</em> PDEs</li>
  </ul>
</section>


<section>
  <h3>Explicit and implicit</h3>
  <p>Implicit:</p>
  <ul>
    <li>No need to resolve fastest time scales</li>
    <li>Steps can be long... but expensive
      <ul>
        <li>Linear/nonlinear solves at each step</li>
        <li>Often these solves involve sparse matvecs</li>
    </ul></li>
    <li>Critical for parabolic PDEs</li>
  </ul>
</section>


<section>
  <h3>Poisson problems</h3>
  <p>Consider 2D Poisson <span class="math display">\[-\nabla^2 u =
      \frac{\partial^2 u}{\partial x^2} +
      \frac{\partial^2 u}{\partial y^2} = f\]</span></p>
  <ul>
    <li>Prototypical elliptic problem (steady state)</li>
    <li>Similar to a backward Euler step on heat equation</li>
  </ul>
</section>


<section>
  <h3>Poisson problem discretization</h3>
  <p><span class="math inline">\(u_{i,j} = h^{-2} \left(
      4u_{i,j}-u_{i-1,j}-u_{i+1,j}-u_{i,j-1}-u_{i,j+1}
      \right)\)</span></p>
</section>


<section>
  <p><span class="math display">\[L =
      \left[
      \begin{array}{ccc|ccc|ccc}
      4 &amp; -1 &amp;    &amp; -1 &amp;    &amp;    &amp;    &amp;    &amp;    \\
      -1 &amp;  4 &amp; -1 &amp;    &amp; -1 &amp;    &amp;    &amp;    &amp;    \\
      &amp; -1 &amp;  4 &amp;    &amp;    &amp; -1 &amp;    &amp;    &amp;    \\ \hline
      -1 &amp;    &amp;    &amp;  4 &amp; -1 &amp;    &amp; -1 &amp;    &amp;    \\
      &amp; -1 &amp;    &amp; -1 &amp;  4 &amp; -1 &amp;    &amp; -1 &amp;    \\
      &amp;    &amp; -1 &amp;    &amp; -1 &amp;  4 &amp;    &amp;    &amp; -1 \\ \hline
      &amp;    &amp;    &amp; -1 &amp;    &amp;    &amp;  4 &amp; -1 &amp;    \\
      &amp;    &amp;    &amp;    &amp; -1 &amp;    &amp; -1 &amp;  4 &amp; -1 \\
      &amp;    &amp;    &amp;    &amp;    &amp; -1 &amp;    &amp; -1 &amp;  4
      \end{array}
      \right]\]</span></p>
</section>


<section>
  <h3>Poisson solvers in 2D/3D</h3>
  <p><span class="math inline">\(N = n^d =\)</span> total
    unknowns</p>
  <p>Ref: Demmel, <em>Applied Numerical Linear Algebra</em>, SIAM, 1997.</p>
  <p>Remember: best MFlop/s <span class="math inline">\(\neq\)</span> fastest solution!</p>
</section>


<section>
  <h3>Poisson solvers in 2D/3D</h3>
  <table>
    <thead>
      <tr class="header">
        <th style="text-align: left;">Method</th>
        <th style="text-align: left;">Time</th>
        <th style="text-align: left;">Space</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td style="text-align: left;">Dense LU</td>
        <td style="text-align: left;"><span class="math inline">\(N^3\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N^2\)</span></td>
      </tr>
      <tr class="even">
        <td style="text-align: left;">Band LU</td>
        <td style="text-align: left;"><span class="math inline">\(N^2\)</span> (<span class="math inline">\(N^{7/3}\)</span>)</td>
        <td style="text-align: left;"><span class="math inline">\(N^{3/2}\)</span> (<span class="math inline">\(N^{5/3}\)</span>)</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;">Jacobi</td>
        <td style="text-align: left;"><span class="math inline">\(N^2\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N\)</span></td>
      </tr>
      <tr class="even">
        <td style="text-align: left;">Explicit inv</td>
        <td style="text-align: left;"><span class="math inline">\(N^2\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N^2\)</span></td>
      </tr>
    </tbody>
  </table>
</section>


<section>
  <h3>Poisson solvers in 2D/3D</h3>
  <table>
    <thead>
      <tr class="header">
        <th style="text-align: left;">Method</th>
        <th style="text-align: left;">Time</th>
        <th style="text-align: left;">Space</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td style="text-align: left;">CG</td>
        <td style="text-align: left;"><span class="math inline">\(N^{3/2}\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N\)</span></td>
      </tr>
      <tr class="even">
        <td style="text-align: left;">Red-black SOR</td>
        <td style="text-align: left;"><span class="math inline">\(N^{3/2}\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N\)</span></td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;">Sparse LU</td>
        <td style="text-align: left;"><span class="math inline">\(N^{3/2}\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N \log N\)</span> (<span class="math inline">\(N^{4/3}\)</span>)</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;">FFT</td>
        <td style="text-align: left;"><span class="math inline">\(N \log N\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N\)</span></td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;">Multigrid</td>
        <td style="text-align: left;"><span class="math inline">\(N\)</span></td>
        <td style="text-align: left;"><span class="math inline">\(N\)</span></td>
      </tr>
    </tbody>
  </table>
</section>


<section>
  <h3>General implicit picture</h3>
  <ul>
    <li>Implicit solves or steady state <span class="math inline">\(\implies\)</span> solving systems</li>
    <li>Nonlinear solvers generally linearize</li>
    <li>Linear solvers can be
      <ul>
        <li>Direct (hard to scale)</li>
        <li>Iterative (often problem-specific)</li>
    </ul></li>
    <li>Iterative solves boil down to matvec!</li>
  </ul>
</section>


<section>
  <h3>PDE solver summary</h3>
  <p>Can be implicit or explicit (as with ODEs)</p>
  <ul>
    <li>Explicit (sparse matvec) — fast, but short steps?
      <ul>
        <li>works fine for hyperbolic PDEs</li>
      </ul>
    <li>Implicit (sparse solve)
      <ul>
        <li>Direct solvers are hard!</li>
        <li>Sparse solvers turn into matvec again</li>
      </ul>
    </li>
  </ul>
</section>


<section>
  <h3>PDE solver summary</h3>
  <p>Differential operators turn into local mesh stencils</p>
  <ul>
    <li>Matrix connectivity looks like mesh connectivity</li>
    <li>Can partition into subdomains that communicate only through boundary data</li>
    <li>More on graph partitioning later</li>
  </ul>
</section>


<section>
  <h3>PDE solver summary</h3>
  <p>Not all nearest neighbor ops are equally efficient!</p>
  <ul>
    <li>Depends on mesh structure</li>
    <li>Also depends on flops/point</li>
  </ul>
</section>
